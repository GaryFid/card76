<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>P.I.D.R. - Punishment Inevitable: Dumb Rules</title>
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="/css/modal.css">
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <style>
    .profile-dropdown {
      display: none;
      position: absolute;
      right: 0;
      top: 56px;
      background: #fff;
      border-radius: 12px;
      box-shadow: 0 4px 16px #1e3c72aa;
      min-width: 180px;
      z-index: 1200;
      padding: 8px 0;
      font-size: 1.08em;
      animation: fadeIn 0.3s;
    }
    .profile-dropdown.active {
      display: block;
    }
    .profile-dropdown-btn {
      width: 100%;
      background: none;
      border: none;
      text-align: left;
      padding: 12px 24px;
      color: #1e3c72;
      font-weight: 600;
      font-size: 1em;
      cursor: pointer;
      transition: background 0.15s;
    }
    .profile-dropdown-btn:hover {
      background: #e3eafc;
      color: #2196f3;
    }
    .profile-modal-bg {
      display: none;
      position: fixed;
      left: 0; top: 0; width: 100vw; height: 100vh;
      background: rgba(30,60,114,0.18);
      z-index: 3000;
      align-items: center;
      justify-content: center;
      transition: background 0.3s;
    }
    .profile-modal-bg.active {
      display: flex;
      animation: fadeInBg 0.4s;
    }
    @keyframes fadeInBg {
      from { background: rgba(30,60,114,0.01); }
      to { background: rgba(30,60,114,0.18); }
    }
    .profile-modal-box {
      background: #fff;
      border-radius: 18px;
      padding: 40px 32px 32px 32px;
      max-width: 400px;
      width: 95vw;
      box-shadow: 0 12px 48px #1e3c72cc, 0 2px 8px #2196f355;
      position: relative;
      text-align: center;
      animation: modalPopIn 0.45s cubic-bezier(.4,0,.2,1);
      overflow: visible;
    }
    @keyframes modalPopIn {
      from { opacity: 0; transform: scale(0.85) translateY(40px); }
      to { opacity: 1; transform: scale(1) translateY(0); }
    }
    .profile-modal-cards {
      position: absolute;
      left: -36px; top: 18px;
      z-index: 1;
      pointer-events: none;
      opacity: 0.18;
    }
    .profile-modal-cards img {
      width: 48px; margin: 0 2px; border-radius: 8px; box-shadow: 0 2px 8px #2196f355;
      transform: rotate(-12deg);
    }
    .profile-modal-cards img:nth-child(2) { transform: rotate(8deg); }
    .profile-modal-cards img:nth-child(3) { transform: rotate(-4deg); }
    .profile-modal-cards img:nth-child(4) { transform: rotate(16deg); }
    .profile-modal-cards img:nth-child(5) { transform: rotate(-18deg); }
    .profile-modal-close {
      position: absolute;
      right: 18px;
      top: 12px;
      font-size: 2em;
      background: none;
      border: none;
      cursor: pointer;
      color: #2196f3;
      z-index: 10;
      transition: color 0.2s;
    }
    .profile-modal-close:hover {
      color: #e53935;
    }
    /* –°—Ç–∏–ª–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏ –¥—Ä—É–∑–µ–π */
    .menu-friends-button {
        position: fixed;
        top: 20px;
        left: 20px;
        z-index: 1000;
        cursor: pointer;
    }

    .menu-icon {
        width: 40px;
        height: 40px;
        background: #ffffff;
        border-radius: 50%;
        display: flex;
        align-items: center;
        justify-content: center;
        box-shadow: 0 2px 5px rgba(0, 0, 0, 0.2);
        transition: all 0.3s ease;
    }

    .menu-icon:hover {
        background: #f0f0f0;
        transform: scale(1.05);
    }

    .menu-icon i {
        font-size: 20px;
        color: #333;
    }

    /* –°—Ç–∏–ª–∏ –¥–ª—è –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –º–µ–Ω—é –∏ –¥—Ä—É–∑–µ–π */
    #menu-friends-modal .modal-content {
        max-width: 500px;
        width: 90%;
    }

    .modal-body {
        padding: 20px;
    }

    .menu-section {
        margin-bottom: 30px;
    }

    .friends-section {
        border-top: 1px solid #eee;
        padding-top: 20px;
    }

    .friends-section h3 {
        margin-bottom: 15px;
        color: #333;
    }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <div class="header-top">
                <div class="header-cards" id="header-cards"></div>
                <div class="header-actions">
                    <div class="wallet-block" id="wallet-block">
                        <button class="wallet-btn" id="wallet-btn">
                            <img src="img/ton-icon.svg" alt="TON" class="crypto-icon">
                            <span class="wallet-balance">0.00</span>
                        </button>
                        <div class="wallet-dropdown" id="wallet-dropdown">
                            <div class="wallet-coin">
                                <img src="img/ton-icon.svg" class="coin-icon" alt="Toncoin">
                                <span class="coin-name">Toncoin</span>
                                <span class="coin-balance">0.00</span>
                            </div>
                            <div class="wallet-coin">
                                <img src="img/jetton-icon.svg" class="coin-icon" alt="JetTon">
                                <span class="coin-name">JetTon</span>
                                <span class="coin-balance">0.00</span>
                            </div>
                            <div class="wallet-coin">
                                <img src="img/solana-icon.svg" class="coin-icon" alt="Solana">
                                <span class="coin-name">Solana</span>
                                <span class="coin-balance">0.00</span>
                            </div>
                            <div class="wallet-coin">
                                <img src="img/trump-icon.svg" class="coin-icon" alt="TRUMP">
                                <span class="coin-name">TRUMP</span>
                                <span class="coin-balance">0.00</span>
                            </div>
                        </div>
                    </div>
                    <button class="friends-btn" id="friends-btn" title="–î—Ä—É–∑—å—è" onclick="showFriendsModal()">
                        <span class="friends-icon">üë•</span>
                        <span class="friends-text">–î—Ä—É–∑—å—è</span>
                    </button>
                    <div class="profile-block" id="profile-block" style="position:relative;">
                        <img src="img/player-avatar.svg" alt="–ü—Ä–æ—Ñ–∏–ª—å" class="profile-avatar">
                        <span class="profile-name" id="profile-name">–ì–æ—Å—Ç—å</span>
                        <div class="profile-dropdown" id="profileDropdown">
                          <button class="profile-dropdown-btn" id="logoutBtn">üö™ –°–º–µ–Ω–∏—Ç—å –∞–∫–∫–∞—É–Ω—Ç</button>
                        </div>
                    </div>
                </div>
            </div>
            <h1>P.I.D.R. - Punishment Inevitable: Dumb Rules</h1>
            <p>P.I.D.R. - Punishment Inevitable: Dumb Rules</p>
        </header>
        
        <main>
            <div class="main-card-loader" id="main-card-loader"></div>
            <div class="card-menu">
                <div class="menu-item" id="start-game">
                    <div class="menu-icon">üéÆ</div>
                    <div class="menu-text">–ù–∞—á–∞—Ç—å –∏–≥—Ä—É</div>
                </div>
                
                <div class="menu-item" id="play-ai">
                    <div class="menu-icon">ü§ñ</div>
                    <div class="menu-text">–ò–≥—Ä–∞—Ç—å —Å –ò–ò</div>
                </div>
                
                <div class="menu-item" id="rating">
                    <div class="menu-icon">üèÜ</div>
                    <div class="menu-text">–†–µ–π—Ç–∏–Ω–≥</div>
                </div>
                
                <div class="menu-item menu-item-shop" id="shop">
                    <div class="menu-icon">üõí</div>
                    <div class="menu-text">–ú–∞–≥–∞–∑–∏–Ω</div>
                </div>
                
                <div class="menu-item" id="rules">
                    <div class="menu-icon">üìã</div>
                    <div class="menu-text">–ü—Ä–∞–≤–∏–ª–∞</div>
                </div>
                <div class="menu-item" id="profile-page-btn">
                    <div class="menu-icon">üë§</div>
                    <div class="menu-text">–ü—Ä–æ—Ñ–∏–ª—å</div>
                </div>
            </div>
        </main>
        
        <footer>
            <p>¬© 2025 P.I.D.R. - Punishment Inevitable: Dumb Rules</p>
        </footer>
    </div>
    
    <script src="js/main.js"></script>
    <script>
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ –ø—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
    try {
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      if (!user || !user.id) {
        window.location.href = '/register.html';
      }
    } catch {
      window.location.href = '/register.html';
    }
    document.getElementById('shop').onclick = () => {
        window.location.href = 'shop.html';
    };
    document.getElementById('start-game').onclick = () => {
        window.location.href = 'game.html';
    };
    document.getElementById('profile-page-btn').onclick = () => {
        window.location.href = 'profile.html';
    };
    function showWelcomeMessage() {
        // –£–¥–∞–ª—è–µ–º —Å—Ç–∞—Ä–æ–µ —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ
        document.body.innerHTML = '';
        // –°–æ–∑–¥–∞—ë–º –∫–æ–Ω—Ç–µ–π–Ω–µ—Ä
        const container = document.createElement('div');
        container.style.display = 'flex';
        container.style.flexDirection = 'column';
        container.style.alignItems = 'center';
        container.style.justifyContent = 'center';
        container.style.height = '100vh';
        container.style.background = 'linear-gradient(135deg, #3390ec 0%, #fff 100%)';
        // –ö–∞—Ä—Ç–∏–Ω–∫–∞ –∫–∞—Ä—Ç
        const img = document.createElement('img');
        img.src = 'img/cards/ace_of_spades.png';
        img.alt = '–ö–∞—Ä—Ç—ã';
        img.style.width = '120px';
        img.style.marginBottom = '24px';
        img.style.boxShadow = '0 8px 32px rgba(0,0,0,0.18)';
        img.style.borderRadius = '12px';
        // –°–æ–æ–±—â–µ–Ω–∏–µ
        const msg = document.createElement('div');
        msg.innerHTML = `<h2 style='color:#222;margin-bottom:10px;'>Welcome to <span style="color:#3390ec">P.I.D.R. - Punishment Inevitable: Dumb Rules</span>!</h2>
        <p style='font-size:18px;color:#444;margin-bottom:18px;'>Ready to play the wildest card game?<br>Gather your friends or challenge the bots!</p>`;
        // –ö–Ω–æ–ø–∫–∞
        const btn = document.createElement('button');
        btn.textContent = '–ò–≥—Ä–∞—Ç—å!';
        btn.className = 'game-btn';
        btn.style.fontSize = '20px';
        btn.style.padding = '14px 38px';
        btn.style.marginTop = '10px';
        btn.style.background = 'linear-gradient(90deg, #3390ec 0%, #1bffff 100%)';
        btn.style.color = '#fff';
        btn.style.border = 'none';
        btn.style.borderRadius = '10px';
        btn.style.boxShadow = '0 2px 12px rgba(51,144,236,0.13)';
        btn.style.cursor = 'pointer';
        btn.onclick = () => {
            window.location.href = 'game.html';
        };
        // –°–æ–±–∏—Ä–∞–µ–º
        container.appendChild(img);
        container.appendChild(msg);
        container.appendChild(btn);
        document.body.appendChild(container);
    }
    // –ü—Ä–æ–≤–µ—Ä–∫–∞ –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏–∏ (welcome —Ç–æ–ª—å–∫–æ –µ—Å–ª–∏ –Ω–µ—Ç user.id)
    try {
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      if (!user || !user.id) {
        showWelcomeMessage();
      }
    } catch {
      showWelcomeMessage();
    }
    // --- –í—ã–ø–∞–¥–∞—é—â–µ–µ –º–µ–Ω—é –ø—Ä–æ—Ñ–∏–ª—è ---
    const profileBlock = document.querySelector('.profile-block');
    const profileDropdown = document.getElementById('profileDropdown');
    const logoutBtn = document.getElementById('logoutBtn');
    let dropdownOpen = false;
    if (profileBlock && profileDropdown) {
      profileBlock.addEventListener('click', function(e) {
        e.stopPropagation();
        dropdownOpen = !dropdownOpen;
        profileDropdown.classList.toggle('active', dropdownOpen);
      });
      // –ö–ª–∏–∫ –≤–Ω–µ –º–µ–Ω—é ‚Äî –∑–∞–∫—Ä—ã—Ç—å
      document.addEventListener('click', function(e) {
        if (!profileDropdown.contains(e.target) && !profileBlock.contains(e.target)) {
          profileDropdown.classList.remove('active');
          dropdownOpen = false;
        }
      });
      // –ö–ª–∏–∫ –≤–Ω—É—Ç—Ä–∏ –º–µ–Ω—é ‚Äî –Ω–µ –∑–∞–∫—Ä—ã–≤–∞—Ç—å
      profileDropdown.addEventListener('click', function(e) {
        e.stopPropagation();
      });
    }
    // --- –í—ã—Ö–æ–¥ –∏–∑ –∞–∫–∫–∞—É–Ω—Ç–∞ ---
    if (logoutBtn) {
      logoutBtn.addEventListener('click', function(e) {
        e.stopPropagation();
        profileDropdown.classList.remove('active');
        dropdownOpen = false;
        localStorage.removeItem('user');
        fetch('/auth/logout', { credentials: 'include' })
          .finally(() => window.location.href = '/register.html');
      });
    }
    </script>

    <!-- –ö–Ω–æ–ø–∫–∞ –º–µ–Ω—é –∏ –¥—Ä—É–∑–µ–π -->
    <div class="menu-friends-button">
        <div class="menu-icon">
            <i class="fas fa-bars"></i>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –º–µ–Ω—é –∏ –¥—Ä—É–∑–µ–π -->
    <div class="universal-modal" id="menu-friends-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ú–µ–Ω—é</div>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <div class="menu-section">
                    <!-- –ó–¥–µ—Å—å –±—É–¥—É—Ç –ø—É–Ω–∫—Ç—ã –º–µ–Ω—é -->
                </div>
                <div class="friends-section">
                    <h3>–î—Ä—É–∑—å—è</h3>
                    <div id="friendsListModal">
                        <!-- –†–µ–∑—É–ª—å—Ç–∞—Ç—ã –ø–æ–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª–µ–Ω—ã –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–æ—Ñ–∏–ª—è -->
    <div class="universal-modal" id="universal-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ü—Ä–æ—Ñ–∏–ª—å</div>
                <button class="close-modal">&times;</button>
            </div>
            <div id="profileModalContent">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–æ—Ñ–∏–ª—è –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –ø—Ä–∞–≤–∏–ª -->
    <div class="universal-modal" id="universal-modal">
        <div class="modal-content">
            <div class="modal-header">
                <div class="modal-title">–ü—Ä–∞–≤–∏–ª–∞</div>
                <button class="close-modal">&times;</button>
            </div>
            <div id="rulesModalContent">
                <!-- –°–æ–¥–µ—Ä–∂–∏–º–æ–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∞–≤–∏–ª –±—É–¥–µ—Ç –¥–æ–±–∞–≤–ª–µ–Ω–æ –¥–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ -->
            </div>
        </div>
    </div>

    <script>
    // --- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–æ—Ñ–∏–ª—è ---
    window.showProfileModal = function() {
      const user = JSON.parse(localStorage.getItem('user') || '{}');
      safeShowModal(`
        <div style="display:flex;flex-direction:column;align-items:center;">
          <img src="${user.avatar || 'img/player-avatar.svg'}" alt="–ê–≤–∞—Ç–∞—Ä" style="width:80px;height:80px;border-radius:50%;box-shadow:0 2px 8px #2196f355;margin-bottom:12px;">
          <div style="font-size:1.2em;font-weight:700;color:var(--tg-theme-text-color,#1e3c72);margin-bottom:6px;">${user.display_name || user.username || '–ì–æ—Å—Ç—å'}</div>
          <div style="color:#2196f3;font-size:1em;margin-bottom:8px;">@${user.telegram_username || ''}</div>
          <div style="color:#444;font-size:1em;margin-bottom:8px;">–†–µ–π—Ç–∏–Ω–≥: <b>${user.rating || 1000}</b></div>
          <div style="color:#444;font-size:1em;margin-bottom:8px;">ID: <b>${user.id || '-'}</b></div>
          <button class="game-btn" style="margin-top:10px;" onclick="logoutProfile()">–í—ã–π—Ç–∏</button>
        </div>
      `, {
        title: '–ü—Ä–æ—Ñ–∏–ª—å',
        onClose: () => {},
      });
    };
    window.logoutProfile = function() {
      localStorage.removeItem('user');
      fetch('/auth/logout', { credentials: 'include' })
        .finally(() => window.location.href = '/register.html');
    };

    // --- –ú–æ–¥–∞–ª–∫–∞ –ø—Ä–∞–≤–∏–ª ---
    window.showRulesModal = function() {
      safeShowModal(`
        <div class="rules-content" style="color:var(--tg-theme-text-color,#1e3c72);text-align:left;max-height:60vh;overflow-y:auto;">
          <h3 style="color:#2196f3;">–ü—Ä–∞–≤–∏–ª–∞ –∏–≥—Ä—ã "P.I.D.R. - Punishment Inevitable: Dumb Rules"</h3>
          <h4>–¶–µ–ª—å –∏–≥—Ä—ã</h4>
          <p>–ò–∑–±–∞–≤–∏—Ç—å—Å—è –æ—Ç –≤—Å–µ—Ö –∫–∞—Ä—Ç –Ω–∞ —Ä—É–∫–µ —Ä–∞–Ω—å—à–µ –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤.</p>
          <h4>–ö–æ–ª–æ–¥–∞ –∏ –ø–æ–¥–≥–æ—Ç–æ–≤–∫–∞</h4>
          <p>–ò–≥—Ä–∞ –≤–µ–¥–µ—Ç—Å—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–π –∫–æ–ª–æ–¥–æ–π –∏–∑ 52 –∫–∞—Ä—Ç (–æ—Ç 2 –¥–æ —Ç—É–∑–∞).</p>
          <p>–ö–∞–∂–¥–æ–º—É –∏–≥—Ä–æ–∫—É —Ä–∞–∑–¥–∞—é—Ç—Å—è 3 –∫–∞—Ä—Ç—ã: 2 –∑–∞–∫—Ä—ã—Ç—ã–µ –∏ 1 –æ—Ç–∫—Ä—ã—Ç–∞—è.</p>
          <h4>–•–æ–¥ –∏–≥—Ä—ã</h4>
          <p><strong>–°—Ç–∞–¥–∏—è 1:</strong> –í—ã–∫–ª–∞–¥–∫–∞ –∫–∞—Ä—Ç</p>
          <ul>
            <li>–ò–≥—Ä–æ–∫–∏ —Ö–æ–¥—è—Ç –ø–æ –æ—á–µ—Ä–µ–¥–∏. –ù–∞—á–∏–Ω–∞–µ—Ç –∏–≥—Ä–æ–∫ —Å —Å–∞–º–æ–π —Å—Ç–∞—Ä—à–µ–π –æ—Ç–∫—Ä—ã—Ç–æ–π –∫–∞—Ä—Ç–æ–π.</li>
            <li>–í —Å–≤–æ–π —Ö–æ–¥ –∏–≥—Ä–æ–∫ –º–æ–∂–µ—Ç –ø–æ–ª–æ–∂–∏—Ç—å —Å–≤–æ—é –∫–∞—Ä—Ç—É –Ω–∞ –æ—Ç–∫—Ä—ã—Ç—É—é –∫–∞—Ä—Ç—É –ª—é–±–æ–≥–æ –æ–ø–ø–æ–Ω–µ–Ω—Ç–∞, –µ—Å–ª–∏ –æ–Ω–∞ –Ω–∞ 1 —Ä–∞–Ω–≥ –≤—ã—à–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, 7 –Ω–∞ 6).</li>
            <li>–¢—É–∑ —Å—á–∏—Ç–∞–µ—Ç—Å—è —Å–∞–º—ã–º —Å—Ç–∞—Ä—à–∏–º, –º–æ–∂–Ω–æ –ø–æ–ª–æ–∂–∏—Ç—å —Ç–æ–ª—å–∫–æ 2 –Ω–∞ —Ç—É–∑–∞.</li>
            <li>–ü–æ—Å–ª–µ –∫–∞–∂–¥–æ–≥–æ —Ö–æ–¥–∞ –∏–≥—Ä–æ–∫ –±–µ—Ä—ë—Ç –Ω–æ–≤—É—é –∫–∞—Ä—Ç—É –∏–∑ –∫–æ–ª–æ–¥—ã –∏ –º–æ–∂–µ—Ç –ø—Ä–æ–¥–æ–ª–∂–∞—Ç—å —Ö–æ–¥–∏—Ç—å, –ø–æ–∫–∞ —É –Ω–µ–≥–æ –µ—Å—Ç—å –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç—å —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥.</li>
            <li>–ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ –º–æ–∂–µ—Ç —Å–¥–µ–ª–∞—Ç—å —Ö–æ–¥ –∫–∞—Ä—Ç–∞–º–∏ –∏–∑ —Ä—É–∫–∏ (–ø–æ–ª–æ–∂–∏—Ç—å –Ω–∞ –∫–∞—Ä—Ç—ã –¥—Ä—É–≥–∏—Ö –∏–≥—Ä–æ–∫–æ–≤), –æ–Ω –º–æ–∂–µ—Ç –ø–æ–ª–æ–∂–∏—Ç—å –∫–∞—Ä—Ç—É –Ω–∞ —Å–≤–æ—é –æ—Ç–∫—Ä—ã—Ç—É—é –∫–∞—Ä—Ç—É –ø–æ —Ç–µ–º –∂–µ –ø—Ä–∞–≤–∏–ª–∞–º.</li>
            <li>–ï—Å–ª–∏ –∏ —ç—Ç–æ –Ω–µ–≤–æ–∑–º–æ–∂–Ω–æ, –∏–≥—Ä–æ–∫ –±–µ—Ä—ë—Ç –∫–∞—Ä—Ç—É –∏–∑ –∫–æ–ª–æ–¥—ã –∏ –µ–≥–æ —Ö–æ–¥ –∑–∞–≤–µ—Ä—à–∞–µ—Ç—Å—è.</li>
            <li>–°—Ç–∞–¥–∏—è –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è, –∫–æ–≥–¥–∞ –∫–æ–ª–æ–¥–∞ –∑–∞–∫–∞–Ω—á–∏–≤–∞–µ—Ç—Å—è.</li>
          </ul>
          <p><strong>–°—Ç–∞–¥–∏—è 2:</strong> –°–±—Ä–æ—Å –∫–∞—Ä—Ç</p>
          <ul>
            <li>–í—Å–µ –∑–∞–∫—Ä—ã—Ç—ã–µ –∫–∞—Ä—Ç—ã –æ—Ç–∫—Ä—ã–≤–∞—é—Ç—Å—è.</li>
            <li>–ò–≥—Ä–æ–∫–∏ –ø–æ –æ—á–µ—Ä–µ–¥–∏ —Å–∫–∏–¥—ã–≤–∞—é—Ç –∫–∞—Ä—Ç—ã –≤ —Ü–µ–Ω—Ç—Ä –ø–æ –ø—Ä–∞–≤–∏–ª—É: –æ–¥–∏–Ω–∞–∫–æ–≤—ã–π —Ä–∞–Ω–≥ –∏–ª–∏ –æ–¥–∏–Ω–∞–∫–æ–≤–∞—è –º–∞—Å—Ç—å.</li>
            <li>–ï—Å–ª–∏ –∏–≥—Ä–æ–∫ –Ω–µ –º–æ–∂–µ—Ç —Å—Ö–æ–¥–∏—Ç—å, –æ–Ω –±–µ—Ä—ë—Ç –∫–∞—Ä—Ç—É –∏–∑ –∫–æ–ª–æ–¥—ã.</li>
            <li>–ï—Å–ª–∏ –∫–æ–ª–æ–¥–∞ –∑–∞–∫–æ–Ω—á–∏–ª–∞—Å—å, —Å–±—Ä–æ—Å –ø–µ—Ä–µ–º–µ—à–∏–≤–∞–µ—Ç—Å—è –∏ —Å—Ç–∞–Ω–æ–≤–∏—Ç—Å—è –Ω–æ–≤–æ–π –∫–æ–ª–æ–¥–æ–π.</li>
          </ul>
          <h4>–ü–æ–±–µ–¥–∞</h4>
          <p>–ü–æ–±–µ–∂–¥–∞–µ—Ç –∏–≥—Ä–æ–∫, –∫–æ—Ç–æ—Ä—ã–π –ø–µ—Ä–≤—ã–º –∏–∑–±–∞–≤–∏—Ç—Å—è –æ—Ç –≤—Å–µ—Ö —Å–≤–æ–∏—Ö –∫–∞—Ä—Ç.</p>
        </div>
      `, {
        title: '–ü—Ä–∞–≤–∏–ª–∞',
        onClose: () => {},
      });
    };

    // --- –ù–∞–≤–µ—à–∏–≤–∞–µ–º –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∏ ---
    document.getElementById('profile-page-btn').onclick = showProfileModal;
    document.getElementById('rules').onclick = showRulesModal;

    // –û–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ –¥–ª—è –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é –∏ –¥—Ä—É–∑–µ–π
    const menuFriendsBtn = document.querySelector('.menu-friends-button');
    const menuFriendsModal = document.getElementById('menu-friends-modal');
    const closeModalBtn = menuFriendsModal.querySelector('.close-modal');

    menuFriendsBtn.addEventListener('click', () => {
        menuFriendsModal.classList.add('active');
        loadFriends(); // –ó–∞–≥—Ä—É–∂–∞–µ–º —Å–ø–∏—Å–æ–∫ –¥—Ä—É–∑–µ–π –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞
    });

    closeModalBtn.addEventListener('click', () => {
        menuFriendsModal.classList.remove('active');
    });

    // –ó–∞–∫—Ä—ã—Ç–∏–µ –º–æ–¥–∞–ª—å–Ω–æ–≥–æ –æ–∫–Ω–∞ –ø—Ä–∏ –∫–ª–∏–∫–µ –≤–Ω–µ –µ–≥–æ
    menuFriendsModal.addEventListener('click', (e) => {
        if (e.target === menuFriendsModal) {
            menuFriendsModal.classList.remove('active');
        }
    });

    // –§—É–Ω–∫—Ü–∏—è –∑–∞–≥—Ä—É–∑–∫–∏ —Å–ø–∏—Å–∫–∞ –¥—Ä—É–∑–µ–π
    async function loadFriends() {
        try {
            const response = await fetch('/api/friends');
            if (!response.ok) {
                showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä—É–∑–µ–π: ' + response.status, 'error');
                document.getElementById('friendsListModal').innerHTML = 
                    '<div class="no-results">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</div>';
                return;
            }
            const data = await response.json();

            const friendsHtml = data.friends && data.friends.length ?
                data.friends.map(friend => `
                    <div class="friend-item">
                        <img src="${friend.avatar_url || '/images/default-avatar.png'}" class="friend-avatar" alt="${friend.username}">
                        <div class="friend-info">
                            <div class="friend-name">${friend.display_name || friend.username}</div>
                            <div class="friend-status ${friend.online ? 'online' : 'offline'}">
                                ${friend.online ? '–í —Å–µ—Ç–∏' : '–ù–µ –≤ —Å–µ—Ç–∏'}
                            </div>
                        </div>
                        <div class="friend-actions">
                            <button class="friend-action-btn invite-btn" onclick="inviteFriend('${friend.id}')">
                                <i class="fas fa-user-plus"></i>
                            </button>
                            <button class="friend-action-btn play-btn" onclick="playWithFriend('${friend.id}')">
                                <i class="fas fa-gamepad"></i>
                            </button>
                        </div>
                    </div>
                `).join('') :
                '<div class="no-results">–£ –≤–∞—Å –ø–æ–∫–∞ –Ω–µ—Ç –¥—Ä—É–∑–µ–π</div>';

            document.getElementById('friendsListModal').innerHTML = friendsHtml;
        } catch (error) {
            showToast('–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏ –¥—Ä—É–∑–µ–π', 'error');
            document.getElementById('friendsListModal').innerHTML = 
                '<div class="no-results">–û—à–∏–±–∫–∞ –∑–∞–≥—Ä—É–∑–∫–∏. –ü–æ–ø—Ä–æ–±—É–π—Ç–µ –ø–æ–∑–∂–µ.</div>';
        }
    }
    </script>
</body>
</html> 