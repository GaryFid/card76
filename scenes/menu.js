const { Scenes, Markup } = require('telegraf');
const config = require('../config');

// –°–æ–∑–¥–∞–µ–º —Å—Ü–µ–Ω—É –≥–ª–∞–≤–Ω–æ–≥–æ –º–µ–Ω—é
const menuScene = new Scenes.BaseScene('menu');

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –≤—Ö–æ–¥–∞ –≤ —Å—Ü–µ–Ω—É
menuScene.enter(async (ctx) => {
  // –°–æ–∑–¥–∞–µ–º –∫–Ω–æ–ø–∫–∏ –º–µ–Ω—é
  const keyboard = [
    ['üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É', 'ü§ñ –ò–≥—Ä–∞—Ç—å —Å –ò–ò'],
    ['üèÜ –†–µ–π—Ç–∏–Ω–≥', 'üìã –ü—Ä–∞–≤–∏–ª–∞']
  ];
  
  // –§–æ—Ä–º–∏—Ä—É–µ–º –æ—Ç–≤–µ—Ç–Ω–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ
  const message = '–ì–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é –∏–≥—Ä—ã "–†–∞–∑–≥–∏–ª—å–¥—è–π":';
  
  // –°–æ–∑–¥–∞–µ–º –∫–ª–∞–≤–∏–∞—Ç—É—Ä—É —Å –∫–Ω–æ–ø–∫–∞–º–∏
  const markup = Markup.keyboard(keyboard).resize();
  
  // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º —Å–æ–æ–±—â–µ–Ω–∏–µ —Å –∫–ª–∞–≤–∏–∞—Ç—É—Ä–æ–π
  await ctx.reply(message, markup);
  
  // –î–æ–±–∞–≤–ª—è–µ–º –∫–Ω–æ–ø–∫—É –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
  const webAppUrl = `${config.appUrl}/webapp`;
  await ctx.reply(
    '–í—ã —Ç–∞–∫–∂–µ –º–æ–∂–µ—Ç–µ –≤–æ—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å—Å—è –Ω–∞—à–∏–º –º–∏–Ω–∏-–ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ–º:',
    Markup.inlineKeyboard([
      Markup.button.webApp('üé≤ –û—Ç–∫—Ä—ã—Ç—å –∏–≥—Ä–æ–≤–æ–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ', webAppUrl)
    ])
  );
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–ù–∞—á–∞—Ç—å –∏–≥—Ä—É"
menuScene.hears('üéÆ –ù–∞—á–∞—Ç—å –∏–≥—Ä—É', (ctx) => {
  ctx.scene.enter('gameSetup');
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–ò–≥—Ä–∞—Ç—å —Å –ò–ò"
menuScene.hears('ü§ñ –ò–≥—Ä–∞—Ç—å —Å –ò–ò', (ctx) => {
  ctx.session.withAI = true;
  ctx.scene.enter('gameSetup');
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–†–µ–π—Ç–∏–Ω–≥"
menuScene.hears('üèÜ –†–µ–π—Ç–∏–Ω–≥', (ctx) => {
  ctx.scene.enter('rating');
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–∞–∂–∞—Ç–∏—è –∫–Ω–æ–ø–∫–∏ "–ü—Ä–∞–≤–∏–ª–∞"
menuScene.hears('üìã –ü—Ä–∞–≤–∏–ª–∞', (ctx) => {
  ctx.scene.enter('rules');
});

// –û–±—Ä–∞–±–æ—Ç—á–∏–∫ –Ω–µ–∏–∑–≤–µ—Å—Ç–Ω—ã—Ö –∫–æ–º–∞–Ω–¥ –∏–ª–∏ —Å–æ–æ–±—â–µ–Ω–∏–π
menuScene.on('message', (ctx) => {
  ctx.reply('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –≤—ã–±–µ—Ä–∏—Ç–µ –æ–¥–Ω—É –∏–∑ –æ–ø—Ü–∏–π –≤ –º–µ–Ω—é.');
});

module.exports = { menuScene }; 